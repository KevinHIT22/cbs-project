---
- name: publish content
  hosts: localhost
  connection: local
  tasks:
  - name: Promote the content views when required
    block:
    - name: Promote the configured content views
      redhat.satellite.content_view_version:
        username: "{{ sat_publisher_username }}"
        password: "{{ sat_publisher_password }}"
        server_url: "{{ sat_server_url }}"
        organization: "{{ sat_organization }}"
        validate_certs: "{{ sat_validate_certs }}"
        content_view: "{{ item.name }}"
        description: "{{ description }}"
        current_lifecycle_environment: "{{ Pre-production }}"
        lifecycle_environments: "{{ CBS-Production }}"
      loop: "{{ content_views | default([], true) }}"

    - name: Promote the configured composite content views
      redhat.satellite.content_view_version:
        username: "{{ sat_publisher_username }}"
        password: "{{ sat_publisher_password }}"
        server_url: "{{ sat_server_url }}"
        organization: "{{ sat_organization }}"
        validate_certs: "{{ sat_validate_certs }}"
        content_view: "{{ item.name }}"
        description: "{{ description }}"
        current_lifecycle_environment: "{{ Pre-production }}"
        lifecycle_environments: "{{ CBS-Production }}"
      loop: "{{ composite_content_views | default([], true) }}"
      when: force_promote == true